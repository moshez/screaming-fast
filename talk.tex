\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{textcomp}
\usepackage{fancyvrb}

\title{Screaming Fast API Clients}
\author{Moshe Zadka -- https://cobordism.com}
\date{2020}

\begin{document}
\begin{titlepage}
\maketitle
\end{titlepage}

\frame{\titlepage}

I live in the San Francisco Bay Area.
I want to acknowledge that the San Francisco Bay Area
is the ancestral home of the Muweka Ohlone.

\begin{frame}
\frametitle{Acknowledgement of Country}

San Francisco Bay Area

Ancestral home of the Muweka Ohlone.

\end{frame}

\begin{frame}
\frametitle{Latency is the Site Killer}

Every 100ms of latency in your site lose more customers

\end{frame}

\begin{frame}
\frametitle{Lognormal Black Swans}

\begin{itemize}
\item Lognormal: $~1/x$ (kinda)
\item Normal: $~e^{-x^2}$
\end{itemize}

\end{frame}

You are extremely unlikely to meet someone over seven feet,
even if you are invited to an NBA team after party --
but some of my posts are 4000 words long,
about 5 standard deviations from my average of 500 words:
this is like meeting someone who's 7 feet two inches
in your local grocery store!

\begin{frame}
\frametitle{Averages Lie}

Only good for normal distributions

\end{frame}

\begin{frame}
\frametitle{Your Backend is Slow}

Lognormal, not normal

\end{frame}

\begin{frame}
\frametitle{Multiplicity Magnifies Outliers}

With 5 queries:

\begin{itemize}
\item P90 becomes P50
\item P99 becomes P90
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Let's Write Some Code}

\lstinputlisting[firstline=14]{middle-fanout.py}

\end{frame}

This is simplified code that shows what usually goes on
in the "middle tier":
makes some queries to the backend,
do some local computation,
and return a JSON.

How long does it take?
The sum of all the times.
This means that a backend that is *occasionally* slow
will make this function *almost always* slow.

\begin{frame}
\frametitle{Let's Write Some Code}

\lstinputlisting[firstline=15,lastline=22]{middle-fanout-klein.py}

\end{frame}


\begin{itemize}
\item Your Backend is Slow
\begin{itemize}
\item Latency costs money
\item Averages are useless
\item Behavior of percentiles
\item Realistic example
\end{itemize}
\item Dealing With Slow Backends
\begin{itemize}
\item Give up
\item Retry
\item Use time wisely
\end{itemize}
\item Realistic example
\begin{itemize}
\item First example
\item Simulation
\item Giving up
\item Retrying
\item Using time wisely
\item Simulation 2
\end{itemize}
\end{itemize}

\end{document}
